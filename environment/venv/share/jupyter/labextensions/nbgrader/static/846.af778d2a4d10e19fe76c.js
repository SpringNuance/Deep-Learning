"use strict";(self.webpackChunknbgrader=self.webpackChunknbgrader||[]).push([[846],{846:(e,t,s)=>{s.r(t),s.d(t,{default:()=>K});var n=s(239),i=s(884),a=s(431),l=s(848),o=s(613),d=s(271);function r(e={},t=!1){const s=new i.Dialog(e);return t?s.addClass("nbgrader-ErrorDialog"):s.addClass("nbgrader-SuccessDialog"),s.launch()}function c(e){var t=document.createElement("div");t.id="validation-message";var s,n,l=!1,o=!1;if(!0===e.success)if(void 0!==(e="string"==typeof e.value?JSON.parse(e.value):e.value).type_changed){l=!0;for(let i=0;i<e.type_changed.length;i++){var d=document.createElement("div");(s=document.createElement("p")).innerText=`The following ${e.type_changed[i].old_type} cell has changed to a ${e.type_changed[i].new_type} cell, but it should not have!`,d.append(s),t.append(d),(n=document.createElement("pre")).innerText=e.type_changed[i].source,t.append(n)}t.classList.add("validation-type-changed")}else if(void 0!==e.changed){l=!0;for(var c=0;c<e.changed.length;c++)d=document.createElement("div"),(s=document.createElement("p")).innerText="The source of the following cell has changed, but it should not have!",d.append(s),t.append(d),(n=document.createElement("pre")).innerText=e.changed[c].source,t.append(n);t.classList.add("validation-changed")}else if(void 0!==e.passed){for(c=0;c<e.changed.length;c++)d=document.createElement("div"),(s=document.createElement("p")).innerText="The following cell passed:",d.append(s),t.append(d),(n=document.createElement("pre")).innerText=e.passed[c].source,t.append(n);t.classList.add("validation-passed")}else if(void 0!==e.failed){for(l=!0,c=0;c<e.failed.length;c++){d=document.createElement("div"),(s=document.createElement("p")).innerText="The following cell failed:",d.append(s),t.append(d);const n=document.createElement("div");n.classList.add("jp-RenderedText");var h=document.createElement("pre");h.innerText=e.failed[c].source,n.append(h),t.append(n);const i=document.createElement("div");i.classList.add("jp-RenderedText");var u=document.createElement("pre");u.innerHTML=e.failed[c].error,i.append(u),t.append(i)}t.classList.add("validation-failed")}else d=document.createElement("div"),(s=document.createElement("p")).innerText="Success! Your notebook passes all the tests.",d.append(s),t.append(d),t.classList.add("validation-success"),o=!0;else l=!0,d=document.createElement("div"),(s=document.createElement("p")).innerText="There was an error running the validate command:",d.append(s),t.append(d),(n=document.createElement("pre")).innerText=e.value,t.append(n);let m;return m=new a.Widget({node:t}),r({title:"Validation Results",body:m,buttons:[i.Dialog.okButton()]},l),o}class h{constructor(e,t,s,n,i,a){this.list_loading_ids=["released_assignments_list_loading","fetched_assignments_list_loading","submitted_assignments_list_loading"],this.list_placeholder_ids=["released_assignments_list_placeholder","fetched_assignments_list_placeholder","submitted_assignments_list_placeholder"],this.list_error_ids=["released_assignments_list_error","fetched_assignments_list_error","submitted_assignments_list_error"],this.released_selector=t,this.fetched_selector=s,this.submitted_selector=n;var o=e.node.getElementsByTagName("div");this.released_element=o.namedItem(t),this.fetched_element=o.namedItem(s),this.submitted_element=o.namedItem(n),this.options=i,this.base_url=i.get("base_url")||l.PageConfig.getBaseUrl(),this.app=a,this.callback=void 0}clear_list(e){var t,s,n=[this.released_element,this.fetched_element,this.submitted_element];for(t=0;t<n.length;t++){for(s=0;s<n[t].children.length;++s)n[t].children[s].classList.contains("list_item")&&(n[t].removeChild(n[t].children[s]),--s);e?(n[t].children.namedItem(this.list_loading_ids[t]).hidden=!1,n[t].children.namedItem(this.list_placeholder_ids[t]).hidden=!0,n[t].children.namedItem(this.list_error_ids[t]).hidden=!0):(n[t].children.namedItem(this.list_placeholder_ids[t]).hidden=!1,n[t].children.namedItem(this.list_loading_ids[t]).hidden=!0,n[t].children.namedItem(this.list_error_ids[t]).hidden=!0)}}load_list_success(e){this.clear_list(!1);for(var t=e.length,s=0;s<t;s++){var n=document.createElement("div");new u(n,e[s],this.fetched_selector,(e=>{this.handle_load_list(e)}),this.options,this.app),"released"===e[s].status?(this.released_element.append(n),this.released_element.children.namedItem("released_assignments_list_placeholder").hidden=!0):"fetched"===e[s].status?(this.fetched_element.append(n),this.fetched_element.children.namedItem("fetched_assignments_list_placeholder").hidden=!0):"submitted"===e[s].status&&(this.submitted_element.append(n),this.submitted_element.children.namedItem("submitted_assignments_list_placeholder").hidden=!0)}var i=this.fetched_element.getElementsByClassName("assignment-notebooks-link");for(let e of i){var a=document.createElement("i");a.classList.add("fa","fa-caret-right"),e.append(a),e.onclick=function(t){e.children[0].classList.contains("fa-caret-right")?(e.children[0].classList.remove("fa-caret-right"),e.children[0].classList.add("fa-caret-down")):(e.children[0].classList.remove("fa-caret-down"),e.children[0].classList.add("fa-caret-right")),t.target.closest(".list_item").querySelector(".collapse").classList.toggle("in")}}this.callback&&(this.callback(),this.callback=void 0)}show_error(e){var t,s=[this.released_element,this.fetched_element,this.submitted_element];for(t=0;t<s.length;t++){for(var n=0;n<s[t].children.length;++n)s[t].children[n].classList.contains("list_item")&&(s[t].removeChild(s[t].children[n]),--n);s[t].children.namedItem(this.list_error_ids[t]).hidden=!1,s[t].children.namedItem(this.list_error_ids[t]).innerText=e,s[t].children.namedItem(this.list_loading_ids[t]).hidden=!0,s[t].children.namedItem(this.list_placeholder_ids[t]).hidden=!0}}handle_load_list(e){e.success?this.load_list_success(e.value):this.show_error(e.value)}async load_list(e,t){this.callback=t,this.clear_list(!0);try{const t=await b("assignments?course_id="+e,{method:"GET"});this.handle_load_list(t)}catch(e){console.error(`Error on GET /assignments.\n${e}`)}}}class u{constructor(e,t,s,n,i,a){this.element=e,this.data=t,this.parent=s,this.on_refresh=n,this.options=i,this.base_url=i.get("base_url")||l.PageConfig.getBaseUrl(),this.app=a,this.style(),this.make_row()}style(){this.element.classList.add("list_item","row")}escape_id(){var e="nbgrader-"+this.data.course_id+"-"+this.data.assignment_id;return(e=e.replace(/ /g,"_")).replace(/[^A-Za-z0-9\-_]/g,"")}make_link(){var e,t=document.createElement("span");if(t.classList.add("item_name","col-sm-6"),"fetched"===this.data.status){e=document.createElement("a");var s=this.escape_id();e.classList.add("collapsed","assignment-notebooks-link"),e.setAttribute("role","button"),e.setAttribute("data-toggle","collapse"),e.setAttribute("data-parent",this.parent),e.setAttribute("href","#"+s),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-controls",s)}else e=document.createElement("span");return e.innerText=this.data.assignment_id,t.append(e),t}submit_error(e){const t=d.createElement("p",null,"Assignment not submitted:"),s=d.createElement("pre",null,e.value);r({title:"Invalid Submission",body:d.createElement("div",{id:"submission-message"},[t,s]),buttons:[i.Dialog.okButton()]},!0)}make_button(){var e=document.createElement("span");e.classList.add("item_status","col-sm-4");var t=document.createElement("button");t.classList.add("btn","btn-primary","btn-xs"),e.append(t);var s=this;return"released"===this.data.status?(t.innerText="fetch",t.onclick=async function(){t.innerText="Fetching...",t.setAttribute("disabled","disabled");const n={course_id:s.data.course_id,assignment_id:s.data.assignment_id};try{const e=await b("assignments/fetch",{body:JSON.stringify(n),method:"POST"});s.on_refresh(e)}catch(t){m(e),e.innerText="Error fetching assignment.",console.error(`Error on POST /assignment_list/fetch ${n}.\n${t}`)}}):"fetched"==this.data.status?(t.innerText="Submit",t.onclick=async function(){t.innerText="submitting...",t.setAttribute("disabled","disabled");const n={course_id:s.data.course_id,assignment_id:s.data.assignment_id};try{const e=await b("assignments/submit",{body:JSON.stringify(n),method:"POST"});e.success?s.on_refresh(e):(s.submit_error(e),t.innerText="Submit",t.removeAttribute("disabled"))}catch(t){m(e),e.innerText="Error submitting assignment.",console.error(`Error on POST /assignment_list/assignments/submit ${n}.\n${t}`)}}):"submitted"==this.data.status&&(t.innerText="Fetch Feedback",t.onclick=async function(){t.innerText="Fetching Feedback...",t.setAttribute("disabled","disabled");const n={course_id:s.data.course_id,assignment_id:s.data.assignment_id};try{const e=await b("assignments/fetch_feedback",{body:JSON.stringify(n),method:"POST"});s.on_refresh(e)}catch(t){m(e),e.innerText="Error fetching feedback.",console.error(`Error on POST /assignments/fetch_feedback ${n}.\n${t}`)}}),e}make_row(){var e=document.createElement("div");e.classList.add("col-md-12");var t=this.make_link();e.append(t);var s,n,i=document.createElement("span");i.classList.add("item_course","col-sm-2"),i.innerText=this.data.course_id,e.append(i);var a=document.createElement("div");if("submitted"==this.data.status){s=this.escape_id()+"-submissions",a.id=s,a.classList.add("panel-collapse","list_container","assignment-notebooks"),a.setAttribute("role","tabpanel"),(o=document.createElement("div")).classList.add("list_item","row"),a.append(o);for(var l=0;l<this.data.submissions.length;l++)n=document.createElement("div"),new g(n,this.data.submissions[l],this.options,this.app),a.append(n)}else if("fetched"===this.data.status){var o;for(s=this.escape_id(),a.id=s,a.classList.add("panel-collapse","list_container","assignment-notebooks","collapse"),a.setAttribute("role","tabpanel"),(o=document.createElement("div")).classList.add("list_item","row"),a.append(o),l=0;l<this.data.notebooks.length;l++)n=document.createElement("div"),this.data.notebooks[l].course_id=this.data.course_id,this.data.notebooks[l].assignment_id=this.data.assignment_id,new p(n,this.data.notebooks[l],this.options,this.app),a.append(n)}e.append(this.make_button()),this.element.innerHTML="",this.element.append(e),this.element.append(a)}}const m=function(e){e.innerHTML=""};class g{constructor(e,t,s,n){this.element=e,this.data=t,this.options=s,this.base_url=s.get("base_url")||l.PageConfig.getBaseUrl(),this.app=n,this.style(),this.make_row()}style(){this.element.classList.add("list_item","row","nested_list_item")}make_row(){var e=document.createElement("div");e.classList.add("col-md-12");var t=document.createElement("span");t.classList.add("item_name","col-sm-6");var s=document.createElement("span").innerText=this.data.timestamp;if(t.append(s),this.data.has_local_feedback&&!this.data.feedback_updated){var n=this.app,i=this.data.local_feedback_path,a=document.createElement("a");a.onclick=function(){n.commands.execute("filebrowser:go-to-path",{path:i})},a.innerText=" (view feedback)",t.append(a)}else if(this.data.has_exchange_feedback)(l=document.createElement("span")).innerText=" (feedback available to fetch)",t.append(l);else{var l;(l=document.createElement("span")).innerText="",t.append(l)}e.append(t);var o=document.createElement("span");o.classList.add("item_course","col-sm-2"),e.append(o);var d=document.createElement("span");d.classList.add("item_status","col-sm-4"),e.append(d),this.element.append(e)}}class p{constructor(e,t,s,n){this.element=e,this.data=t,this.options=s,this.base_url=s.get("base_url")||l.PageConfig.getBaseUrl(),this.app=n,this.style(),this.make_row()}style(){this.element.classList.add("list_item","row","nested_list_item")}make_button(){var e=this,t=document.createElement("span");t.classList.add("item_status","col-sm-4");var s=document.createElement("button");return s.classList.add("btn","btn-default","btn-xs"),t.append(s),s.innerText="Validate",s.onclick=async function(){s.innerText="Validating...",s.setAttribute("disabled","disabled");const n={path:e.data.path};try{const t=await b("assignments/validate",{body:JSON.stringify(n),method:"POST"});s.innerText="Validate",s.removeAttribute("disabled"),c(t)?e.validate_success(s):e.validate_failure(s)}catch(e){m(t),t.innerText="Error validating assignment.",console.error(`Error on POST /assignments/validate ${n}.\n${e}`)}},t}validate_success(e){e.classList.remove("btn-default","btn-danger","btn-success"),e.classList.add("btn-success")}validate_failure(e){e.classList.remove("btn-default","btn-danger","btn-success"),e.classList.add("btn-danger")}make_row(){var e=this.app,t=this.data.path,s=document.createElement("div");s.classList.add("col-md-12");var n=document.createElement("span");n.classList.add("item_name","col-sm-6");var i=document.createElement("a");i.href="#",i.innerText=this.data.notebook_id,i.onclick=function(){e.commands.execute("docmanager:open",{path:t})},n.append(i),s.append(n);var a=document.createElement("span");a.classList.add("item_course","col-sm-2"),s.append(a),s.append(this.make_button()),this.element.append(s)}}class v{constructor(e,t,s,n,i,a,o){this.options=new Map,this.course_list_selector=t,this.default_course_selector=s,this.dropdown_selector=n,this.refresh_selector=i,this.course_list_element=e.node.getElementsByTagName("ul").namedItem(t);var d=e.node.getElementsByTagName("button");this.default_course_element=d.namedItem(s),this.dropdown_element=d.namedItem(n),this.refresh_element=d.namedItem(i),this.assignment_list=a,this.current_course=void 0,this.options=o,this.base_url=o.get("base_url")||l.PageConfig.getBaseUrl(),this.data=void 0;var r=this;this.dropdown_element.onclick=function(){r.course_list_element.classList.toggle("open")},document.onclick=function(e){e.target.closest("button")!=r.dropdown_element&&r.course_list_element.classList.remove("open")},this.refresh_element.onclick=function(){r.load_list()},this.bind_events()}enable_list(){this.dropdown_element.removeAttribute("disabled")}disable_list(){this.dropdown_element.setAttribute("disabled","disabled")}clear_list(){this.course_list_element.children.length>0&&(this.course_list_element.innerHTML="")}bind_events(){this.refresh_element.click()}async load_list(){this.disable_list(),this.clear_list(),this.assignment_list.clear_list(!0);try{const e=await b("courses");this.handle_load_list(e)}catch(e){console.error(`Error on GET /courses.\n${e}`)}}handle_load_list(e){e.success?this.load_list_success(e.value):(this.default_course_element.innerText="Error fetching courses!",this.enable_list(),this.assignment_list.show_error(e.value))}load_list_success(e){if(this.data=e,this.disable_list(),this.clear_list(),0===this.data.length)return this.default_course_element.innerText="No courses found.",this.assignment_list.clear_list(!1),void this.enable_list();this.data.includes(this.current_course)||(this.current_course=void 0),void 0===this.current_course?this.change_course(this.data[0]):this.change_course(this.current_course)}change_course(e){this.disable_list(),void 0!==this.current_course&&(this.default_course_element.innerText=e),this.current_course=e,this.default_course_element.innerText=this.current_course,this.assignment_list.load_list(e,(()=>{this.load_assignment_list_success()}))}load_assignment_list_success(){if(this.data){for(var e=this,t=function(t){return function(){e.change_course(t)}},s=0;s<this.data.length;s++){var n=document.createElement("a");n.href="#",n.innerText=this.data[s];var i=document.createElement("li");i.append(n),i.onclick=t(this.data[s]),this.course_list_element.append(i)}this.data=void 0}this.enable_list()}}async function b(e="",t={}){const s=o.ServerConnection.makeSettings(),n=l.URLExt.join(s.baseUrl,e);let i;try{i=await o.ServerConnection.makeRequest(n,t,s)}catch(e){throw new o.ServerConnection.NetworkError(e)}const a=await i.json();if(!i.ok)throw new o.ServerConnection.ResponseError(i,a.message);return a}class _ extends a.Widget{constructor(e){super(),this.app=e,console.log("Initializing the assignments list widget");var t=['<div id="assignments" class="tab-pane">','  <div id="assignments_toolbar" class="row list_toolbar">','    <div class="col-sm-8 no-padding">','      <span id="assignments_list_info" class="toolbar_info">Released, downloaded, and submitted assignments for course:</span>','      <div class="btn-group btn-group-xs">','        <button type="button" class="btn btn-default" id="course_list_default">Loading, please wait...</button>','        <button type="button" class="btn btn-default dropdown-toggle" id="course_list_dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" disabled="disabled">','          <span class="caret"></span>','          <span class="sr-only">Toggle Dropdown</span>',"        </button>",'        <ul class="dropdown-menu" id="course_list">',"        </ul>","      </div>","    </div>",'    <div class="col-sm-4 no-padding tree-buttons">','      <span id="assignments_buttons" class="pull-right toolbar_buttons">','      <button id="refresh_assignments_list" title="Refresh assignments list" class="btn btn-default btn-xs"><i class="fa fa-refresh"></i></button>',"      </span>","    </div>","  </div>",'  <div class="alert alert-danger version_error">',"  </div>",'  <div class="panel-group">','    <div class="panel panel-default">','      <div class="panel-heading">',"        Released assignments","      </div>",'      <div class="panel-body">','        <div id="released_assignments_list" class="list_container">','          <div id="released_assignments_list_placeholder" class="list_placeholder">',"            <div> There are no assignments to fetch. </div>","          </div>",'          <div id="released_assignments_list_loading" class="list_loading">',"            <div> Loading, please wait... </div>","          </div>",'          <div id="released_assignments_list_error" class="list_error">',"            <div></div>","          </div>","        </div>","      </div>","    </div>",'    <div class="panel panel-default">','      <div class="panel-heading">',"        Downloaded assignments","      </div>",'      <div class="panel-body">','        <div id="fetched_assignments_list" class="list_container" role="tablist" aria-multiselectable="true">','          <div id="fetched_assignments_list_placeholder" class="list_placeholder">',"            <div> There are no downloaded assignments. </div>","          </div>",'          <div id="fetched_assignments_list_loading" class="list_loading">',"            <div> Loading, please wait... </div>","          </div>",'          <div id="fetched_assignments_list_error" class="list_error">',"            <div></div>","          </div>","        </div>","      </div>","    </div>",'    <div class="panel panel-default">','      <div class="panel-heading">',"        Submitted assignments","      </div>",'      <div class="panel-body">','        <div id="submitted_assignments_list" class="list_container">','          <div id="submitted_assignments_list_placeholder" class="list_placeholder">',"            <div> There are no submitted assignments. </div>","          </div>",'          <div id="submitted_assignments_list_loading" class="list_loading">',"            <div> Loading, please wait... </div>","          </div>",'          <div id="submitted_assignments_list_error" class="list_error">',"            <div></div>","          </div>","        </div>","      </div>","    </div>","  </div>   ","</div>"].join("\n");this.node.innerHTML=t,this.node.style.overflowY="auto";let s=l.PageConfig.getBaseUrl(),n=new Map;n.set("base_url",s);var i=new h(this,"released_assignments_list","fetched_assignments_list","submitted_assignments_list",n,this.app);new v(this,"course_list","course_list_default","course_list_dropdown","refresh_assignments_list",i,n),this.checkNbGraderVersion()}checkNbGraderVersion(){var e=this.node.getElementsByClassName("version_error")[0];e.hidden=!1,b("nbgrader_version?version=0.8.2").then((t=>{t.success||(e.innerText=t.message,e.style.display="block")})).catch((e=>{console.error(`Error on GET /assignment_list/nbgrader_version.\n${e}`)}))}}const f={id:"nbgrader/assignment-list",autoStart:!0,requires:[i.ICommandPalette],optional:[n.ILayoutRestorer],activate:async(e,t,s)=>{let n;const a="nbgrader:open-assignment-list";let l=new i.WidgetTracker({namespace:"nbgrader-assignment-list"});e.commands.addCommand(a,{label:"Assignment List",execute:()=>{if(!n){const t=new _(e);n=new i.MainAreaWidget({content:t}),n.id="nbgrader-assignment-list",n.addClass("nbgrader-mainarea-widget"),n.title.label="Assignments",n.title.closable=!0}l.has(n)||l.add(n),n.isAttached||e.shell.add(n,"main"),n.content.update(),e.shell.activateById(n.id)}}),t.addItem({command:a,category:"nbgrader"}),null!=s&&s.restore(l,{command:a,name:()=>"nbgrader-assignment-list"}),console.log("JupyterLab extension assignment-list is activated!")}};class k extends i.IFrame{constructor(e,t){super(),this.referrerPolicy="strict-origin-when-cross-origin",this.sandbox=["allow-scripts","allow-same-origin","allow-forms"],this.node.id="formgrader-iframe",this.app=e,this.url=t;var s=this;window.addEventListener("message",(function(e){s.on_click(e)}))}on_click(e){if(this.node.querySelector("iframe").contentWindow===e.source){var t=JSON.parse(e.data);this.app.commands.execute(t.command,t.arguments)}}}const C={id:"nbgrader/formgrader",autoStart:!0,requires:[i.ICommandPalette],optional:[n.ILayoutRestorer],activate:async(e,t,s)=>{let n;console.log("JupyterLab extension formgrader is activated!");const a="nbgrader:open-formgrader";let d=new i.WidgetTracker({namespace:"nbgrader-formgrader"});e.commands.addCommand(a,{label:"Formgrader",execute:async t=>{if(!n){const s=o.ServerConnection.makeSettings(),a=t.url||l.URLExt.join(s.baseUrl,"formgrader"),d=new k(e,a);n=new i.MainAreaWidget({content:d}),n.id="formgrader",n.title.label="Formgrader",n.title.closable=!0}d.has(n)||d.add(n),n.isAttached||e.shell.add(n,"main"),n.content.update(),e.shell.activateById(n.id)}}),t.addItem({command:a,category:"nbgrader"}),null!=s&&s.restore(d,{command:a,name:()=>"nbgrader-formgrader"})}};async function L(e="",t={}){const s=o.ServerConnection.makeSettings(),n=l.URLExt.join(s.baseUrl,e);let i;try{i=await o.ServerConnection.makeRequest(n,t,s)}catch(e){throw new o.ServerConnection.NetworkError(e)}const a=await i.json();if(!i.ok)throw new o.ServerConnection.ResponseError(i,a.message);return a}function w(e,t){var s=document.createElement("div");s.classList.add("list_item","row");var n=document.createElement("div");n.classList.add("col-md-12");var i=document.createElement("span");i.classList.add("item_name","col-sm-2");var a=document.createElement("a");if(a.href="#",a.innerText=e.course_id,"local"==e.kind)a.href="#",a.onclick=function(){t.commands.execute("nbgrader:open-formgrader",e)};else{const t=e.url;a.href=l.URLExt.join(t.replace(/formgrader$/,"lab"),"workspaces","formgrader"),a.target="blank"}var o=document.createElement("span");return o.classList.add("item_course","col-sm-2"),o.textContent=e.kind,i.append(a),n.append(i),n.append(o),s.append(n),s}class E{constructor(e,t){this.course_list_element=e,this.app=t,this.listplaceholder=document.createElement("div"),this.listplaceholder.id="formgrader_list_placeholder",this.listplaceholder.classList.add("list_placeholder");var s=document.createElement("div");s.textContent="There are no available formgrader services.",this.listplaceholder.hidden=!0,this.listplaceholder.appendChild(s),this.course_list_element.appendChild(this.listplaceholder),this.listloading=document.createElement("div"),this.listloading.id="formgrader_list_loading",this.listloading.classList.add("list_loading");var n=document.createElement("div");n.textContent="Loading, please wait...",this.listloading.appendChild(n),this.course_list_element.appendChild(this.listloading),this.listerror=document.createElement("div"),this.listerror.id="formgrader_list_error",this.listerror.classList.add("list_error"),this.listerrortext=document.createElement("div"),this.listerrortext.textContent="There are no available formgrader services.",this.listerror.hidden=!0,this.listerror.appendChild(this.listerrortext),this.course_list_element.appendChild(this.listerror)}clear_list(e){for(;this.course_list_element.lastChild.classList.contains("list_item");)this.course_list_element.removeChild(this.course_list_element.lastChild);e?(this.listloading.hidden=!1,this.listplaceholder.hidden=!0,this.listerror.hidden=!0):(this.listplaceholder.hidden=!1,this.listloading.hidden=!0,this.listerror.hidden=!0)}show_error(e){for(;this.course_list_element.lastChild.classList.contains("list_item");)this.course_list_element.removeChild(this.course_list_element.lastChild);this.listerrortext.textContent=e.message,this.listerror.hidden=!1,this.listloading.hidden=!0,this.listplaceholder.hidden=!0}load_list(){this.clear_list(!0),L("formgraders").then((e=>this.handle_load_list.call(this,e))).catch(this.show_error)}handle_load_list(e){e.success?this.load_list_success(e.value):this.show_error(e.value)}load_list_success(e){this.clear_list(!1);var t=e.length;t>0&&(this.listplaceholder.hidden=!0);for(var s=0;s<t;s++)this.course_list_element.appendChild(w(e[s],this.app))}}class y extends a.Widget{constructor(e){super(),this.app=e;var t=document.createElement("div");t.id="courses",t.classList.add("tab-pane"),this.version_alert=document.createElement("div"),this.version_alert.classList.add("alert","alert-danger","version_error"),this.version_alert.hidden=!0,t.appendChild(this.version_alert);var s=document.createElement("div");s.classList.add("panel-group");var n=document.createElement("div");n.classList.add("panel","panel-default");var i=document.createElement("div");i.classList.add("panel-heading"),i.textContent="Available formgraders";var a=document.createElement("span");a.id="formgrader_buttons",a.classList.add("pull-right","toolbar_buttons");var l=document.createElement("button");l.id="refresh_formgrader_list",l.title="Refresh formgrader list",l.classList.add("btn","btn-default","btn-xs");var o=document.createElement("i");o.classList.add("fa","fa-refresh"),l.appendChild(o),a.appendChild(l),i.appendChild(a),n.appendChild(i);var d=document.createElement("div");d.classList.add("panel-body");var r=document.createElement("div");r.id="formgrader_list",r.classList.add("list_container"),this.courselist=new E(r,this.app),d.appendChild(r),n.appendChild(d),s.appendChild(n),t.appendChild(s),this.node.appendChild(t),this.node.style.overflowY="auto",l.onclick=()=>this.courselist.load_list.call(this.courselist),this.checkNbGraderVersion(),this.courselist.load_list()}checkNbGraderVersion(){L("nbgrader_version?version=0.8.2").then((e=>{e.success||(this.version_alert.textContent=e.message,this.version_alert.hidden=!1)})).catch((e=>{console.error(`The course_list server extension appears to be missing.\n${e}`)}))}}const I={id:"nbgrader/course-list",autoStart:!0,requires:[i.ICommandPalette],optional:[n.ILayoutRestorer],activate:async(e,t,s)=>{let n;const a="nbgrader:open-course-list";let l=new i.WidgetTracker({namespace:"nbgrader-course-list"});e.commands.addCommand(a,{label:"Course List",execute:()=>{if(!n){const t=new y(e);n=new i.MainAreaWidget({content:t}),n.id="nbgrader-course-list",n.addClass("nbgrader-mainarea-widget"),n.title.label="Courses",n.title.closable=!0}l.has(n)||l.add(n),n.isAttached||e.shell.add(n,"main"),n.content.update(),e.shell.activateById(n.id)}}),t.addItem({command:a,category:"nbgrader"}),null!=s&&s.restore(l,{command:a,name:()=>"nbgrader-course-list"}),console.log("JupyterLab extension course-list is activated!")}};var T=s(679),x=s(918),N=s(840);const S="nbgrader";var P,W,D;!function(e){e.cleanNbgraderData=function(t,s){const n=e.getNbgraderData(t);return!(null==n||!W.isInvalid(n,s)||(n.schema_version=3,n.solution=!1,n.grade=!1,n.locked=!1,n.task=!1,e.setNbgraderData(n,t),0))},e.clearCellType=function(e){const t=e.get(S);null!=t&&("cell_type"in t&&(t.cell_type=void 0),e.set(S,t))},e.getNbgraderData=function(e){if(null==e)return null;const t=e.get("nbgrader");return null==t?null:t.valueOf()},e.isGraded=function(e){return W.isGraded(e)},e.isRelevantToNbgrader=function(e){return W.isGraded(e)||W.isSolution(e)},e.newNbgraderData=function(e){if(""===e.type)return null;const t=new A;return t.grade=D.getGrade(e),t.grade_id=D.getGradeId(e),t.locked=D.getLocked(e),t.points=D.getPoints(e),t.schema_version=D.getSchemeaVersion(),t.solution=D.getSolution(e),t.task=D.getTask(e),t},e.newToolData=function(e,t){const s=new B;return W.isInvalid(e,t)?(s.type="",s):(s.type=W.getType(e,t),""===s.type||((W.isGrade(e)||W.isSolution(e)||W.isLocked(e))&&(s.id=W.getGradeId(e)),W.isGraded(e)&&(s.points=W.getPoints(e)),s.locked=W.isLocked(e)),s)},e.setNbgraderData=function(e,t){if(null==e)return void(t.has(S)&&t.delete(S));const s=t.get(S);(null==s?null:s.valueOf())!=e&&t.set(S,e.toJson())}}(P||(P={})),function(e){function t(e){return null!=e&&!0===e.grade}e.getGradeId=function(e){return null==e||null==e.grade_id?"":e.grade_id},e.getPoints=function(t){return null==t?0:e._to_float(t.points)},e.getSchemeaVersion=function(e){return null===e?0:e.schema_version},e.getType=function(s,n){return e.isTask(s)?"task":e.isSolution(s)&&t(s)?"manual":e.isSolution(s)&&"code"===n?"solution":e.isGrade(s)&&"code"===n?"tests":e.isLocked(s)?"readonly":""},e.isGrade=t,e.isGraded=function(t){return e.isGrade(t)||e.isTask(t)},e.isInvalid=function(t,s){return!e.isTask(t)&&"code"!==s&&e.isSolution(t)!=e.isGrade(t)},e.isLocked=function(t){return!e.isSolution(t)&&(e.isGraded(t)||null!=t&&!0===t.locked)},e.isSolution=function(e){return null!=e&&!0===e.solution},e.isTask=function(e){return null!=e&&!0===e.task},e._to_float=function(e){if(null==e||""===e)return 0;const t=typeof e;return"string"===t?parseFloat(e):"number"===t?e:0}}(W||(W={})),function(e){e.getGrade=function(e){return"manual"===e.type||"tests"===e.type},e.getGradeId=function(e){return null==e.id?"":e.id},e.getLocked=function(t){return!(e.getSolution(t)||!e.getGrade(t)&&"task"!==t.type&&"tests"!==t.type&&"readonly"!==t.type)},e.getPoints=function(t){if(e.getGrade(t)||e.getTask(t))return t.points>=0?t.points:0},e.getSchemeaVersion=function(){return 3},e.getSolution=function(e){return"manual"===e.type||"solution"===e.type},e.getTask=function(e){return"task"===e.type}}(D||(D={}));class A{toJson(){const e={};return null!=this.grade&&(e.grade=this.grade),null!=this.grade_id&&(e.grade_id=this.grade_id),null!=this.locked&&(e.locked=this.locked),null!=this.points&&(e.points=this.points),null!=this.schema_version&&(e.schema_version=this.schema_version),null!=this.solution&&(e.solution=this.solution),null!=this.task&&(e.task=this.task),e}}class B{}const M="nbgrader-mod-active",V="nbgrader-mod-highlight",G="nbgrader-mod-locked",H="nbgrader-mod-uneditable";function R(e={}){const t=new i.Dialog(e);return t.addClass("nbgrader-ErrorDialog"),t.launch()}class O extends a.Panel{constructor(e,t){super(),this.notebookPanelWidgets=new Map,this.addClass("nbgrader-CreateAssignmentWidget"),this.addNotebookListeners(e),this.addMainAreaActiveListener(t),this.activeNotebook=null,this.notebookTracker=e,this.shell=t}addNotebookListeners(e){this.currentNotebookListener=this.getCurrentNotebookListener(),e.currentChanged.connect(this.currentNotebookListener)}addMainAreaActiveListener(e){this.mainAreaListener=this.getMainAreaActiveListener(),e.currentChanged.connect(this.mainAreaListener)}async addNotebookWidget(e,t){if(null===t)return;await t.revealed;const s=new J(t);return this.addWidget(s),this.notebookPanelWidgets.set(t,s),t.disposed.connect((()=>{s.dispose()})),s.disposed.connect((()=>{this.notebookPanelWidgets.delete(t)})),e.currentWidget!=t&&s.hide(),t.revealed}dispose(){if(!this.isDisposed){if(null!=this.notebookPanelWidgets)for(const e of this.notebookPanelWidgets)e[1].dispose();null!=this.notebookTracker&&this.removeNotebookListeners(this.notebookTracker),this.activeNotebook=null,this.notebookPanelWidgets=null,this.notebookTracker=null,super.dispose()}}getCurrentNotebookListener(){return async(e,t)=>{if(null!=this.activeNotebook){const e=this.notebookPanelWidgets.get(this.activeNotebook);null!=e&&e.hide()}if(null!=t){this.isVisible&&null==this.notebookPanelWidgets.get(t)&&await this.addNotebookWidget(e,t);const s=this.notebookPanelWidgets.get(t);null!=s&&s.show()}this.activeNotebook=t}}getMainAreaActiveListener(){return async(e,t)=>{t.newValue instanceof T.NotebookPanel||!this.isVisible||this.hideRightPanel()}}onBeforeShow(e){if(super.onBeforeShow(e),null!=this.activeNotebook){const e=this.notebookPanelWidgets.get(this.activeNotebook);null==e?this.addNotebookWidget(this.notebookTracker,this.activeNotebook):e.show()}}onAfterShow(){const e=this.shell.widgets("main");null==this.activeNotebook?this.hideRightPanel():(0,x.each)(e,(e=>{e.title==this.activeNotebook.title&&(e.isVisible?e.activate():this.hideRightPanel())}))}hideRightPanel(){this.shell.collapseRight()}removeNotebookListeners(e){e.currentChanged.disconnect(this.currentNotebookListener),this.currentNotebookListener=null}}class $ extends a.Panel{constructor(e){super(),this._click=new N.Signal(this),this._cell=e,this.addMetadataListener(e),this.initLayout(),this.initClickListener(),this.initInputListeners(),this.initMetadata(e),this.addClass("nbgrader-CellWidget")}async addMetadataListener(e){await e.ready,this.metadataChangedHandler=this.getMetadataChangedHandler(),e.model.metadata.changed.connect(this.metadataChangedHandler)}get cell(){return this._cell}cleanNbgraderData(e){P.cleanNbgraderData(e.model.metadata,e.model.type)}get click(){return this._click}dispose(){var e,t,s,n,i;this.isDisposed||(null!=this.metadataChangedHandler&&(null===(n=null===(s=null===(t=null===(e=this.cell)||void 0===e?void 0:e.model)||void 0===t?void 0:t.metadata)||void 0===s?void 0:s.changed)||void 0===n||n.disconnect(this.metadataChangedHandler)),null!=this.onclick&&(null===(i=this.node)||void 0===i||i.removeEventListener("click",this.onclick)),null!=this.taskInput&&(this.taskInput.onchange=null),null!=this.gradeIdInput&&(this.gradeIdInput.onchange=null),null!=this.pointsInput&&(this.pointsInput.onchange=null),this._cell=null,this._click=null,this.metadataChangedHandler=null,this.onclick=null,this.lock=null,this.gradeId=null,this.points=null,this.taskInput=null,this.gradeIdInput=null,this.pointsInput=null,super.dispose())}getCellStateChangedListener(e,t){return(s,n)=>{"executionCount"==n.name&&(t.innerText=e.innerText)}}getMetadataChangedHandler(){return(e,t)=>{const s=P.getNbgraderData(e),n=P.newToolData(s,this.cell.model.type);this.updateValues(n)}}getOnInputChanged(){return()=>{const e=new B;if(e.type=this.taskInput.value,this.gradeId.classList.contains(H)){const t=P.getNbgraderData(this.cell.model.metadata);null==(null==t?void 0:t.grade_id)?e.id="cell-"+this.randomString(16):e.id=t.grade_id,this.gradeIdInput.value=e.id}else e.id=this.gradeIdInput.value;this.points.classList.contains(H)||(e.points=this.pointsInput.valueAsNumber);const t=P.newNbgraderData(e);P.setNbgraderData(t,this.cell.model.metadata)}}getOnTaskInputChanged(){const e=this.getOnInputChanged();return()=>{e(),this.updateDisplayClass()}}initClickListener(){this.onclick=()=>{this._click.emit()},this.node.addEventListener("click",this.onclick)}initInputListeners(){this.taskInput.onchange=this.getOnTaskInputChanged(),this.gradeIdInput.onchange=this.getOnInputChanged(),this.pointsInput.onchange=this.getOnInputChanged()}initLayout(){const e=document.createElement("div"),t=this.newHeaderElement(),s=this.newTaskElement(),n=this.newIdElement(),i=this.newPointsElement(),a=[t,s,n,i],l=document.createDocumentFragment();for(const e of a)l.appendChild(e);e.appendChild(l),this.node.appendChild(e),this.lock=t.getElementsByTagName("a")[0],this.gradeId=n,this.points=i,this.taskInput=s.getElementsByTagName("select")[0],this.gradeIdInput=n.getElementsByTagName("input")[0],this.pointsInput=i.getElementsByTagName("input")[0]}async initMetadata(e){if(await e.ready,null==e.model)return;this.cleanNbgraderData(e);const t=P.getNbgraderData(e.model.metadata),s=P.newToolData(t,this.cell.model.type);P.clearCellType(e.model.metadata),this.updateDisplayClass(),this.updateValues(s)}newHeaderElement(){const e=document.createElement("div");e.className="nbgrader-CellHeader";const t=this.cell.promptNode.cloneNode(!0);e.appendChild(t),this.cell.model.stateChanged.connect(this.getCellStateChangedListener(this.cell.promptNode,t));const s=document.createElement("a");s.className="nbgrader-LockButton";const n=document.createElement("li");return n.className="fa fa-lock",n.title="Student changes will be overwritten",s.appendChild(n),e.appendChild(s),e}newIdElement(){const e=document.createElement("div");e.className="nbgrader-CellId";const t=document.createElement("label");t.textContent="ID: ";const s=document.createElement("input");return s.type="text",t.appendChild(s),e.appendChild(t),e}newPointsElement(){const e=document.createElement("div");e.className="nbgrader-CellPoints";const t=document.createElement("label");t.textContent="Points: ";const s=document.createElement("input");return s.type="number",s.min="0",t.appendChild(s),e.appendChild(t),e}newTaskElement(){const e=document.createElement("div");e.className="nbgrader-CellType";const t=document.createElement("label");t.textContent="Type: ";const s=document.createElement("select"),n=new Map([["","-"],["manual","Manually graded answer"],["task","Manually graded task"],["solution","Autograded answer"],["tests","Autograded tests"],["readonly","Read-only"]]);"code"!==this.cell.model.type&&(n.delete("solution"),n.delete("tests"));const a=document.createDocumentFragment();for(const e of n.entries()){const t=document.createElement("option");t.value=e[0],t.innerHTML=e[1],a.appendChild(t)}s.appendChild(a);const l=i.Styling.wrapSelect(s);return t.appendChild(l),e.appendChild(t),e}randomString(e){var t,s="",n="abcdef0123456789";for(t=0;t<e;t++)s+=n[Math.floor(Math.random()*n.length)];return s}setActive(e){e?this.addClass(M):this.removeClass(M)}setGradeId(e){this.gradeIdInput.value=e}setElementEditable(e,t){t?e.classList.remove(H):e.classList.add(H)}setGradeIdEditable(e){this.setElementEditable(this.gradeId,e)}setPoints(e){this.pointsInput.value=e.toString()}setPointsEditable(e){this.setElementEditable(this.points,e)}setTask(e){this.taskInput.value=e}updateDisplayClass(){const e=P.getNbgraderData(this.cell.model.metadata);P.isRelevantToNbgrader(e)?this.addClass(V):this.removeClass(V)}updateValues(e){this.setTask(e.type),null==e.id?(this.setGradeIdEditable(!1),this.setGradeId("")):(this.setGradeId(e.id),this.setGradeIdEditable(!0)),null==e.points?(this.setPointsEditable(!1),this.setPoints(0)):(this.setPoints(e.points),this.setPointsEditable(!0)),e.locked?this.lock.classList.add(G):this.lock.classList.remove(G)}}class U extends a.Widget{constructor(){super(),this.addClass("nbgrader-NotebookHeaderWidget"),this.initLayout()}dispose(){this.isDisposed||(this.pointsInput=null,super.dispose())}initLayout(){const e=this.newTotalPointsElement();this.node.appendChild(e),this.pointsInput=e.getElementsByTagName("input")[0]}newTotalPointsElement(){const e=document.createElement("div");e.className="nbgrader-NotebookPoints";const t=document.createElement("label");t.innerText="Total points:";const s=document.createElement("input");return s.className="nbgrader-TotalPointsInput",s.type="number",s.disabled=!0,t.appendChild(s),e.appendChild(t),e}set totalPoints(e){null!=this.pointsInput&&(this.pointsInput.value=e.toString())}}class j extends a.Panel{constructor(e){super(),this.activeCell=null,this._cellMetadataChanged=new N.Signal(this),this.cellWidgets=new Map,this.metadataChangedHandlers=new Map,this.activeCell=e.content.activeCell,this.activeCellWidgetListener=this.getActiveCellWidgetListener(),this._notebookPanel=e,this.addClass("nbgrader-NotebookWidget"),this.addCellListener(e),this.addCellListListener(e),this.initCellWidgets(e.content),this.validateSchemaVersion(),this.addValidateIdsListener(),this.addNotebookDisposedListener(e)}addCellListener(e){this.cellListener=this.getActiveCellListener(),e.content.activeCellChanged.connect(this.cellListener)}addCellListListener(e){this.cellListListener=(t,s)=>{switch(s.type){case"add":{const t=this.findCellInArray(s.newValues[0],e.content.widgets);this.addCellWidget(t,s.newIndex);break}case"move":{const t=e.content.widgets[s.newIndex];this.moveCellWidget(t,s.newIndex);break}case"remove":{const e=this.findDeadCell(this.cellWidgets.keys());null!=e?this.removeCellWidget(e):console.warn("nbgrader: Unable to find newly deleted cell.");break}case"set":{const t=this.findDeadCell(this.cellWidgets.keys());if(null!=t){const n=this.findCellInArray(s.newValues[0],e.content.widgets);this.cellWidgets.get(t).dispose(),this.cellWidgets.delete(t);const i=this.addCellWidget(n,s.newIndex);this.activeCell===n&&(i.setActive(this.activeCell===n),this.scrollIntoViewNearest(i))}}}},e.model.cells.changed.connect(this.cellListListener)}addCellWidget(e,t){const s=new $(e);this.cellWidgets.set(e,s),null==t?this.addWidget(s):this.insertWidget(t,s),s.click.connect(this.activeCellWidgetListener);const n=this.getMetadataChangedHandler(s);return e.model.metadata.changed.connect(n),this.metadataChangedHandlers.set(s,n),s}addNotebookDisposedListener(e){this.notebookDisposedListener=this.getNotebookDisposedListener(),e.disposed.connect(this.notebookDisposedListener)}addValidateIdsListener(){this.validateIdsListener=(e,t)=>{"started"==t&&this.validateIds()},this.notebookPanel.context.saveState.connect(this.validateIdsListener)}get cellMetadataChanged(){return this._cellMetadataChanged}dispose(){var e,t,s,n,i,a,l,o,d,r,c,h,u;if(!this.isDisposed){if(null!=this.cellWidgets)for(const e of this.cellWidgets)this.removeCellWidget(e[0]);null!=this.cellListener&&(null===(s=null===(t=null===(e=this.notebookPanel)||void 0===e?void 0:e.content)||void 0===t?void 0:t.activeCellChanged)||void 0===s||s.disconnect(this.cellListener)),null!=this.cellListListener&&(null===(l=null===(a=null===(i=null===(n=this.notebookPanel)||void 0===n?void 0:n.model)||void 0===i?void 0:i.cells)||void 0===a?void 0:a.changed)||void 0===l||l.disconnect(this.cellListListener)),null!=this.validateIdsListener&&(null===(r=null===(d=null===(o=this.notebookPanel)||void 0===o?void 0:o.context)||void 0===d?void 0:d.saveState)||void 0===r||r.disconnect(this.validateIdsListener)),null!=this.notebookDisposedListener&&(null===(h=null===(c=this.notebookPanel)||void 0===c?void 0:c.disposed)||void 0===h||h.disconnect(this.notebookDisposedListener)),null===(u=this.notebookPanel)||void 0===u||u.dispose(),this.activeCell=null,this.activeCellWidgetListener=null,this.cellListener=null,this.cellListListener=null,this._cellMetadataChanged=null,this.cellWidgets=null,this.metadataChangedHandlers=null,this.notebookDisposedListener=null,this._notebookPanel=null,this.validateIdsListener=null,super.dispose()}}findCellInArray(e,t){return t.find(((t,s,n)=>t.model===e))}findDeadCell(e){for(const t of e)if(null==t.model)return t}getActiveCellListener(){return(e,t)=>{if(null!=this.activeCell){const e=this.cellWidgets.get(this.activeCell);null!=e&&e.setActive(!1)}if(null!=t){const e=this.cellWidgets.get(t);null!=e&&(e.setActive(!0),this.scrollIntoViewNearest(e))}this.activeCell=t}}getActiveCellWidgetListener(){return e=>{const t=this.notebookPanel.content.widgets.indexOf(e.cell);this.notebookPanel.content.activeCellIndex=t}}getNotebookDisposedListener(){return e=>{this.dispose()}}initCellWidgets(e){for(const t of e.widgets)this.addCellWidget(t).setActive(e.activeCell===t)}getMetadataChangedHandler(e){return(t,s)=>{this.cellMetadataChanged.emit(e)}}moveCellWidget(e,t){const s=this.cellWidgets.get(e);this.insertWidget(t,s)}get notebookPanel(){return this._notebookPanel}removeCellWidget(e){var t,s,n,i,a;if(null==this.cellWidgets)return;const l=this.cellWidgets.get(e);if(null==l)return;null!=this.activeCellWidgetListener&&(null===(t=l.click)||void 0===t||t.disconnect(this.activeCellWidgetListener));const o=null===(s=this.metadataChangedHandlers)||void 0===s?void 0:s.get(l);null!=o&&(null===(a=null===(i=null===(n=e.model)||void 0===n?void 0:n.metadata)||void 0===i?void 0:i.changed)||void 0===a||a.disconnect(o)),this.cellWidgets.delete(e),l.dispose()}validateIds(){const e=new Set,t=/^[a-zA-Z0-9_\-]+$/,s=this.notebookPanel.model.cells.iter();for(let n=s.next();null!=n;n=s.next()){const s=P.getNbgraderData(n.metadata);if(null==s)continue;const i=s.grade_id;if(!t.test(i))return void this.warnInvalidId(!0,!1,i);if(e.has(i))return void this.warnInvalidId(!1,!0,i);e.add(i)}}validateSchemaVersion(){const e=this.notebookPanel.model.cells.iter();for(let t=e.next();null!=t;t=e.next()){const e=P.getNbgraderData(t.metadata);let s=null==e?null:e.schema_version;if(s=void 0===s?0:s,null!=s&&s<3)return void this.warnSchemaVersion(s)}}warnInvalidId(e,t,s){const n={buttons:[i.Dialog.okButton()],title:void 0,body:void 0};return e?(n.title="Invalid nbgrader cell ID",n.body="At least one cell has an invalid nbgrader ID. Cell IDs must contain at least one character, and may only contain letters, numbers, hyphens, and/or underscores.",void R(n)):t?(n.title="Duplicate nbgrader cell ID",n.body=`The nbgrader ID "${s}" has been used for more than one cell. Please make sure all grade cells have unique ids.`,void R(n)):void 0}warnSchemaVersion(e){const t=e.toString(),s=this.notebookPanel.sessionContext.path,n=document.createElement("p"),l=document.createElement("code"),o={title:"Outdated schema version",body:new a.Widget({node:n}),buttons:[i.Dialog.okButton()]};n.innerText=`At least one cell has an old version (${t}) of the nbgrader metadata. Please back up this notebook and then update the metadata on the command line using the following command: `,l.innerText=`nbgrader update ${s}`,n.appendChild(l),R(o)}scrollIntoViewNearest(e){const t=this.node.scrollTop,s=t+this.node.clientHeight,n=e.node.offsetTop,i=n+e.node.clientHeight;n<t?e.node.scrollIntoView(!0):i>s&&(i-n>s-t?e.node.scrollIntoView(!0):e.node.scrollIntoView(!1))}}class J extends a.Panel{constructor(e){super(),this.addClass("nbgrader-NotebookPanelWidget"),this.initLayout(e),this.setUpTotalPoints()}calcTotalPoints(){let e=0;const t=this.notebookWidget.notebookPanel.model.cells.iter();for(let s=t.next();null!=s;s=t.next()){const t=P.getNbgraderData(s.metadata);e+=null!=t&&null!=t.points&&P.isGraded(t)?t.points:0}return e}dispose(){var e,t,s,n,i,a,l,o,d;this.isDisposed||(null!=this.cellListListener&&(null===(i=null===(n=null===(s=null===(t=null===(e=this.notebookWidget)||void 0===e?void 0:e.notebookPanel)||void 0===t?void 0:t.model)||void 0===s?void 0:s.cells)||void 0===n?void 0:n.changed)||void 0===i||i.disconnect(this.cellListListener)),null!=this.cellModelListener&&(null===(l=null===(a=this.notebookWidget)||void 0===a?void 0:a.cellMetadataChanged)||void 0===l||l.disconnect(this.cellModelListener)),null===(o=this.notebookHeaderWidget)||void 0===o||o.dispose(),null===(d=this.notebookWidget)||void 0===d||d.dispose(),this.cellListListener=null,this.cellModelListener=null,this.notebookHeaderWidget=null,this.notebookWidget=null,super.dispose())}initLayout(e){this.notebookHeaderWidget=new U,this.notebookWidget=new j(e),this.addWidget(this.notebookHeaderWidget),this.addWidget(this.notebookWidget)}setUpTotalPoints(){this.notebookHeaderWidget.totalPoints=this.calcTotalPoints(),this.cellListListener=(e,t)=>{"move"!=t.type&&(this.notebookHeaderWidget.totalPoints=this.calcTotalPoints())},this.cellModelListener=(e,t)=>{this.notebookHeaderWidget.totalPoints=this.calcTotalPoints()},this.notebookWidget.notebookPanel.model.cells.changed.connect(this.cellListListener),this.notebookWidget.cellMetadataChanged.connect(this.cellModelListener)}}const F={id:"nbgrader/create-assignment",autoStart:!0,requires:[T.INotebookTracker,n.ILabShell],activate:function(e,t,s){console.log('Activating extension "create_assignment".');const n=new a.Panel;n.node.style.overflowY="auto";const i=new O(t,s);n.addWidget(i),n.id="nbgrader-create_assignemnt",n.title.label="Create Assignment",n.title.caption="nbgrader Create Assignment",e.shell.add(n,"right"),console.log('Extension "create_assignment" activated.')}};var q=s(923);async function Y(e="",t={},s){const n=new URLSearchParams;if(null!=s)for(const e of s.entries())n.append(e[0],e[1]);const i=o.ServerConnection.makeSettings(),a=l.URLExt.join(i.baseUrl,e)+"?"+n.toString();let d;try{d=await o.ServerConnection.makeRequest(a,t,i)}catch(e){throw new o.ServerConnection.NetworkError(e)}const r=await d.json();if(!d.ok)throw new o.ServerConnection.ResponseError(d,r.message);return r}class z extends i.ToolbarButton{constructor(e){super({className:"validate-button",label:"Validate",onClick:()=>{this.buttonCallback()},tooltip:"Validate Assignment"}),this._buttonCallback=this.newButtonCallback(),this._versionCheckCallback=this.newVersionCheckCallback(),this._saveCallback=this.newSaveCallback(),this.panel=e}get buttonCallback(){return this._buttonCallback}get saveCallback(){return this._saveCallback}get versionCheckCallback(){return this._versionCheckCallback}dispose(){this.isDisposed||(this.panel=null,super.dispose())}newSaveCallback(){return(e,t)=>{if("completed"!==t&&"failed"!==t)return;if(this.panel.context.saveState.disconnect(this.saveCallback),"completed"!==t)return r({title:"Validation failed",body:"Cannot save notebook",buttons:[i.Dialog.okButton()],focusNodeSelector:"input"},!0),this.setButtonLabel(),void this.setButtonDisabled(!1);this.setButtonLabel("Validating...");const s=this.panel.context.path;Y("assignments/validate",{method:"POST"},new Map([["path",s]])).then((e=>{c(e),this.setButtonLabel(),this.setButtonDisabled(!1)})).catch((e=>{r({title:"Validation failed",body:`Cannot validate: ${e}`,buttons:[i.Dialog.okButton()],focusNodeSelector:"input"},!0),this.setButtonLabel(),this.setButtonDisabled(!1)}))}}newVersionCheckCallback(){return e=>{!0===e.success?(this.setButtonDisabled(),this.setButtonLabel("Saving..."),this.panel.context.saveState.connect(this.saveCallback),this.panel.context.save()):r({title:"Version Mismatch",body:e.message,buttons:[i.Dialog.okButton()],focusNodeSelector:"input"},!0)}}newButtonCallback(){return()=>{Y("nbgrader_version",void 0,new Map([["version","0.8.2"]])).then(this.versionCheckCallback).catch((e=>{r({title:"Validation failed",body:`Cannot check version: ${e}`,buttons:[i.Dialog.okButton()],focusNodeSelector:"input"},!0)}))}}setButtonDisabled(e=!0){const t=this.node.getElementsByTagName("button")[0];e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled")}setButtonLabel(e="Validate"){this.node.getElementsByClassName("jp-ToolbarButtonComponent-label")[0].innerText=e}}class Z{createNew(e,t){const s=new z(e);let n=e.toolbar.children(),i=0;for(let e=0;;e++){let t=n.next();if(null==t)break;if(t.node.classList.contains("jp-Toolbar-spacer")){i=e;break}}return e.toolbar.insertItem(i,"runAll",s),new q.DisposableDelegate((()=>{s.dispose()}))}}const K=[C,f,I,F,{id:"nbgrader/validate-assignment",autoStart:!0,activate:e=>{console.log("JupyterLab extension validate-assignment is activated!"),e.docRegistry.addWidgetExtension("Notebook",new Z)}}]}}]);